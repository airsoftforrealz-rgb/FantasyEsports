generator client { provider = "prisma-client-js" }

datasource db { provider = "sqlite" url = env("DATABASE_URL") }

model User {
  id String @id @default(cuid())
  email String @unique
  passwordHash String
  displayName String
  createdAt DateTime @default(now())
  memberships LeagueMembership[]
  rosters FantasyRoster[]
  notifications Notification[]
  drafts DraftPick[]
  snapshots LeaderboardSnapshot[]
}

model League {
  id String @id @default(cuid())
  name String
  inviteCode String @unique
  size Int
  draftType String
  draftTime DateTime
  scoringPreset String
  privacy String
  createdAt DateTime @default(now())
  memberships LeagueMembership[]
  draft Draft?
  rosters FantasyRoster[]
  tournamentId String?
  tournament Tournament? @relation(fields:[tournamentId], references:[id])
  @@index([tournamentId])
}

model LeagueMembership {
  id String @id @default(cuid())
  userId String
  leagueId String
  role String
  joinedAt DateTime @default(now())
  user User @relation(fields:[userId], references:[id])
  league League @relation(fields:[leagueId], references:[id])
  @@unique([userId,leagueId])
}

model Draft {
  id String @id @default(cuid())
  leagueId String @unique
  status String
  currentPick Int @default(1)
  startedAt DateTime?
  league League @relation(fields:[leagueId], references:[id])
  picks DraftPick[]
}

model DraftPick {
  id String @id @default(cuid())
  draftId String
  userId String
  playerId String
  pickNumber Int
  madeAt DateTime @default(now())
  draft Draft @relation(fields:[draftId], references:[id])
  user User @relation(fields:[userId], references:[id])
  player Player @relation(fields:[playerId], references:[id])
  @@index([draftId,pickNumber])
}

model FantasyRoster {
  id String @id @default(cuid())
  userId String
  leagueId String
  name String
  points Int @default(0)
  user User @relation(fields:[userId], references:[id])
  league League @relation(fields:[leagueId], references:[id])
  slots RosterSlot[]
}

model RosterSlot {
  id String @id @default(cuid())
  rosterId String
  playerId String
  slotType String
  isStarter Boolean @default(true)
  lockedAt DateTime?
  roster FantasyRoster @relation(fields:[rosterId], references:[id])
  player Player @relation(fields:[playerId], references:[id])
}

model Player {
  id String @id @default(cuid())
  name String
  role String
  status String
  teamId String
  collegeAffiliation String?
  projection Float
  team Team @relation(fields:[teamId], references:[id])
  statLines StatLine[]
  picks DraftPick[]
  slots RosterSlot[]
  @@index([teamId, role])
}

model Team {
  id String @id @default(cuid())
  name String
  region String
  isCollege Boolean @default(false)
  collegeAffiliation String?
  players Player[]
  homeMatches Match[] @relation("home")
  awayMatches Match[] @relation("away")
}

model Tournament {
  id String @id @default(cuid())
  name String
  type String
  startDate DateTime
  endDate DateTime
  matches Match[]
  leagues League[]
}

model Match {
  id String @id @default(cuid())
  tournamentId String
  homeTeamId String
  awayTeamId String
  status String
  startsAt DateTime
  tournament Tournament @relation(fields:[tournamentId], references:[id])
  homeTeam Team @relation("home", fields:[homeTeamId], references:[id])
  awayTeam Team @relation("away", fields:[awayTeamId], references:[id])
  statLines StatLine[]
  maps MatchMap[]
  @@index([tournamentId, startsAt])
}

model MatchMap {
  id String @id @default(cuid())
  matchId String
  mapName String
  homeScore Int
  awayScore Int
  match Match @relation(fields:[matchId], references:[id])
}

model StatLine {
  id String @id @default(cuid())
  playerId String
  matchId String
  kills Int
  assists Int
  deaths Int
  plants Int
  defuses Int
  clutches Int
  multikills Int
  won Boolean
  player Player @relation(fields:[playerId], references:[id])
  match Match @relation(fields:[matchId], references:[id])
  @@index([matchId, playerId])
}

model LeaderboardSnapshot {
  id String @id @default(cuid())
  userId String
  leagueId String?
  tournamentId String?
  points Int
  period String
  createdAt DateTime @default(now())
  user User @relation(fields:[userId], references:[id])
  @@index([period, createdAt])
}

model Notification {
  id String @id @default(cuid())
  userId String
  title String
  body String
  read Boolean @default(false)
  createdAt DateTime @default(now())
  user User @relation(fields:[userId], references:[id])
}
